# ğŸš˜ ì¤‘ê³ ì°¨ ê°€ê²© ì˜ˆì¸¡  í”„ë¡œì íŠ¸ [[ë§í¬]](https://github.com/highfreshness/portfolio/tree/master/%EC%9C%A0%EB%9F%BD%20%EC%A4%91%EA%B3%A0%EC%B0%A8%20%EA%B0%80%EA%B2%A9%EC%98%88%EC%B8%A1)



## ğŸ“Œ í”„ë¡œì íŠ¸ ì£¼ì œ

* ìœ ëŸ½ ì¤‘ê³ ì°¨ ë°ì´í„°ë¥¼ ì´ìš©í•œ ì¤‘ê³ ì°¨ ê°€ê²© ì˜ˆì¸¡ ëª¨ë¸ ì œì‘

---

## ğŸ“Œ í”„ë¡œì íŠ¸ ê¸°ê°„ 

* 2021ë…„ 10ì›” 18ì¼ ~ 10ì›” 22ì¼ ê¹Œì§€(1ì£¼)

---

## ğŸ“Œí”„ë¡œì íŠ¸ ì°¸ì—¬ ì¸ì›

* ì „ì²˜ë¦¬ / ì‹œê°í™” -  2ëª…

* ëª¨ë¸ ë¶„ì„ / ìµœì í™” - 2ëª… (ê¸€ì“´ì´)

---

## ğŸ“Œì‚¬ìš©ëœ ê°œë°œ í™˜ê²½ / ë¼ì´ë¸ŒëŸ¬ë¦¬

* ê°œë°œ í™˜ê²½

  * Window10 21H1(OS ë¹Œë“œ 19043.1237)

  * Python 3.7.3

  * Jupyter-Notebook

  * Google Colab

    

* ë¼ì´ë¸ŒëŸ¬ë¦¬

  * ì „ì²˜ë¦¬ / ì‹œê°í™”

    * Matplotlib 3.1.1

    * Lux

      * lux-api 0.4.0
      * lux-widget 0.1.7

    * seaborn 0.9.0

      

  * ëª¨ë¸ ë¶„ì„ / HPO

    * Pandas 1.2.5

    * Pycaret 2.1.2

    * Scikit-learn 0.23

    * Scipy 1.5.3

    * Catboost 1.0.0

    * Tensorflow 1.13.1

      

---

## ğŸ“Œ í”„ë¡œì íŠ¸ ì„¤ëª…

* ì „ì²˜ë¦¬ / ì‹œê°í™”

  * BMW (**10781í–‰**) ì™€ ì „ì²´ ë°ì´í„°(BMW + Audi + Benz + Ford + Hyundai + Toyota)(**64131í–‰**) ëŒ€ìƒ

  * ì •ë‹µì¸ Price ì—´ê³¼ ë‹¤ë¥¸ í–‰ë“¤ì˜ ê´€ê³„ë¥¼ ê·¸ë˜í”„, íˆíŠ¸ë§µ ì‹œê°í™”ë¡œ í™•ì¸

  * ê²°ì¸¡ì¹˜ ëŒ€ì²´

  * ì—´ì˜ ë°ì´í„° í˜•íƒœ, ì‹¤ì œ ê¸°ì¤€ì— ë”°ë¥¸ ë²”ì£¼í™” ì§„í–‰

    

* ëª¨ë¸ / ë¶„ì„

  * ë°ì´í„°ë¥¼ Pycaret ì„ í†µí•´ ëª¨ë¸ë³„ ì„±ëŠ¥ ë¹„êµ
  * Pycaretì„ ì´ìš©í•œ ìµœê³  ì„±ëŠ¥ ëª¨ë¸ HPO(Hyper-Parameter Optimization) ë° ì˜ˆì¸¡ ì„±ëŠ¥ í™•ì¸
  * Pycaretì˜ HPO ì™€ GridSearch HPO ì˜ˆì¸¡ ì„±ëŠ¥ í™•ì¸
  * Pycaretì—ì„œ HPOë¥¼ í•œ ëª¨ë¸ê³¼ í•˜ì§€ ì•Šì€ ëª¨ë¸ì˜ ì˜ˆì¸¡ ì„±ëŠ¥ ë¹„êµ
  * Pycaret ëª¨ë¸ ì„±ëŠ¥ ë¹„êµë¥¼ í†µí•´ êµ¬í•œ Top3 ëª¨ë¸ì˜ Blending ëª¨ë¸ ì˜ˆì¸¡ ì„±ëŠ¥ ë¹„êµ
  * ê°™ì€ ì¡°ê±´ ë‚´ í–‰ì˜ ìˆ˜ê°€ ëŠ˜ì–´ë‚  ê²½ìš° ì˜ˆì¸¡ ì„±ëŠ¥ ë¹„êµ

---

## ğŸ“Œ í•µì‹¬ ì½”ë“œ

* ì „ì²˜ë¦¬ / ì‹œê°í™”

```python
# DataFrameì˜ ê²°ì¸¡ì¹˜, ì´ìƒì¹˜ ì œê±° ë° ëŒ€ì²´

# engineSize 0(=ê²°ì¸¡ì¹˜) i3ëª¨ë¸ì—ë§Œ ë°œìƒí•˜ê³  ìˆì–´ ì‹¤ì œ ì—”ì§„ì‚¬ì´ì¦ˆ 0.6ìœ¼ë¡œ ë³€ê²½
bmw.loc[(bmw['model']=='i3'), ['engineSize']] = 0.6 
bmw['tax'] = bmw['tax'].replace(to_replace=0, value=bmw['tax'].median())

bmw['model'] = bmw[['model']].apply(lambda x: x.str.strip())
bmw.loc[(bmw['fuelType']=='Hybrid') & (bmw['model']=='i3'), ['mpg']] = 111
bmw.loc[(bmw['fuelType']=='Electric') & (bmw['model']=='i3'), ['mpg']] = 118
bmw.loc[(bmw['fuelType']=='Other') & (bmw['model']=='i3'), ['mpg']] = 118
bmw['engineSize'] = bmw[['engineSize']].replace(0,bmw['engineSize'].mode()[0])
bmw['tax'] = bmw[['tax']].replace(0,bmw[['tax']].median())

# tax ë²”ì£¼í™”
bmw['tax_cut'] = pd.cut(bmw.tax,bins=[0,20,30,130,155,170,210,250,275,315,340,600],
                       labels=['A','B','C','D','E','F','G','H','I','J','K'])

# ì—”ì§„ í¬ê¸° ë²”ì£¼í™”
bmw['engineSize'] =  bmw['engineSize']//1

# ì „ì²´ ë°ì´í„° ëŒ€ìƒ Heatmap
num_vars = ['price','mileage', 'tax', 'mpg', 'engineSize']
mask = np.triu(used_car_all[num_vars].corr(),1)
sns.heatmap(used_car_all[num_vars].corr(), mask=mask, annot=True)
plt.show()
```



* ëª¨ë¸ / ë¶„ì„

```python
# Catboost ëª¨ë¸ ìƒì„± + Hyper parameter íŠœë‹
catboost = create_model('catboost')
tuned_catboost_pycaret = tune_model(catboost, n_iter = 100, optimize = 'RMSE')


# GridSearch 
model_catboostReg = CatBoostRegressor()
param_grid_catboost = {
                        'learning_rate': [0.01, 0.05, 0.1],
                        'iterations': [100, 300, 500],
					  #In most cases, the optimal depth ranges from 4 to 10. Values in the range from 6 to 10 are recommended.
    				   'depth': [6, 8, 10], 
                        'l2_leaf_reg': [1, 3, 5, 7, 10]
                       }

grid_search_result = model_catboostReg.grid_search(param_grid_catboost, 
                                       X=x_train_transformed, 
                                       y=y_train, 
                                       plot=True)


# ì—°ì†í˜• ë³€ìˆ˜ ì—´ ì…ë ¥
numeric_features = ['year','mileage','tax','mpg']
numeric_transformer = StandardScaler() # cf) RobustScaler

# ë²”ì£¼í˜• ë³€ìˆ˜ ì—´ ì…ë ¥
categorical_features = ['model','transmission','fuelType','engineSize']
categorical_transformer = OneHotEncoder(categories='auto', handle_unknown='ignore') # ë²”ì£¼í˜• ë°ì´í„°ê°€ x_train, x_testì— ê³ ë¥´ê²Œ ë“¤ì–´ê°€ì§€ ì•ŠëŠ” ê²½ìš°ë¥¼ pass í•˜ê¸° ìœ„í•´ handel_unknown param ='ignore' ë¡œ ì„¤ì •

preprocessor = ColumnTransformer(
    transformers=[ # List of (name, transformer, column(s))
        ('num', numeric_transformer, numeric_features),
        ('cat', categorical_transformer, categorical_features)])
preprocessor_pipe = Pipeline(steps=[('preprocessor', preprocessor)])
preprocessor_pipe.fit(x_train, x_test) # StandardScaler, One-Hot Encoder ì ìš©


# Tuned Model Ensemble
blender = blend_models(estimator_list = [tuned_cat,tuned_rf,tuned_et], optimize = 'RMSE')
```



---

## ğŸ“Œ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

* Pycaret ëª¨ë¸ ë¹„êµ ì—ëŸ¬

  * Pycaret ë‚´ model_compare  ì‚¬ìš© ì‹œ Huber Regressor ì°¨ë¡€ì—ì„œ ì˜¤ë¥˜ ë°œìƒ
    * model_compare ì‹œ Huber Regressor ì œì™¸ ì˜µì…˜ ì„ íƒ í›„ ì§„í–‰
    * Scipy ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ì „ ìˆ˜ì •(1.5.3)

---

## ğŸ“Œ í›„ì† ê³¼ì œ

* ë”¥ëŸ¬ë‹ Hyper-Parameter Optimization ì§„í–‰

* Tensor Board í™œìš©

* ì „ì²´ ë°ì´í„°ì— í¬í•¨ë˜ì§€ ì•Šì€ íšŒì‚¬ ë°ì´í„° ì¶”ê°€

* ì „ì²´ ë°ì´í„° ëŒ€ìƒ EDA(Exploratory Data Analysis)

  

---

## ğŸ“Œ íšŒê³  / ëŠë‚€ ì 

* ì „ì²˜ë¦¬ë‚˜ HPOë¥¼ í†µí•œ ì˜ˆì¸¡ì„±ëŠ¥ í–¥ìƒì—ëŠ” í•œê³„ê°€ ìˆìœ¼ë©°, ë°ì´í„°ì˜ ì–‘ì´ ê°€ì¥ í° ì˜í–¥ì„ ì¤€ë‹¤.

* Pycaret ë‚´ë¶€ ê¸°ëŠ¥ ì¤‘ ì¼ë¶€ëŠ” íŠ¹ì • ëª¨ë¸ì—ì„œ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.
  * Catboost ì²˜ëŸ¼ Pycaret ë‚´ë¶€ ê¸°ëŠ¥ ì¤‘ ì¼ë¶€ë¥¼ ì‚¬ìš©í•˜ì§€ ëª»í•˜ëŠ” ê²½ìš° ì§ì ‘ ìë£Œë‚˜ ì‚¬ìš©ë²• í™•ì¸ í›„ ì•ˆë˜ëŠ” ê¸°ëŠ¥ì— ëŒ€í•´ì„œëŠ” ë³„ë„ í™•ì¸ì´ í•„ìš”í•˜ë‹¤.
  
* Blending ì²˜ëŸ¼ ì•™ìƒë¸” ê¸°ë²•ì„ ì´ìš©í•œ ê²½ìš° ëª¨ë¸ ê¸°ë°˜ì´ ë¹„ìŠ·í• ìˆ˜ë¡ ì˜ˆì¸¡ ì„±ëŠ¥ í–¥ìƒì„ ê¸°ëŒ€í•˜ê¸° ì–´ë µë‹¤.

* ì²˜ìŒ ë°ì´í„° í™•ì¸ì„ í–ˆì„ ë•Œ ë°ì´í„° ìƒì—ì„œ 'ì™œ ì´ë ‡ê²Œ ì…ë ¥ì´ ë˜ì–´ìˆì§€?' ë¼ëŠ” ê¶ê¸ˆì¦ì´ ë“¤ ë°ì´í„°ë“¤ì´ ë§ì•˜ëŠ”ë° ê²€ìƒ‰ì„ í•´ë³¼ ìˆ˜ë¡ ë„ë©”ì¸ ì§€ì‹ì´ ìŒ“ì˜€ê³ 

  ì™œ ê·¸ëŸ° ë°ì´í„°ë“¤ì´ ìˆëŠ”ì§€ ì–´ëŠ ì •ë„ ë‚©ë“í•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ë“¤ì´ ëŠ˜ì–´ë‚¬ë‹¤. ì–´ë–¤ í”„ë¡œì íŠ¸ë¼ë„ í•´ë‹¹í•˜ëŠ” ë„ë©”ì¸ ì§€ì‹ì´ ì–´ëŠ ì •ë„ í™•ë³´ë˜ì–´ì•¼ í”„ë¡œì íŠ¸ì˜ ì§„í–‰ì´ë‚˜ EDAì— ì¢‹ì€ ì˜í–¥ì„ ë¼ì¹œ ë‹¤ëŠ” ê²ƒì„ ëŠê¼ˆë‹¤.

